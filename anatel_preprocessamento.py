# -*- coding: utf-8 -*-
"""Anatel_PreProcessamento.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1GqyYKdvbb5lUZ9icdHYRgKWeI4YRe3no

![py2.png](data:image/png;base64,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)        **ANATEL - Pré processamento dos dados históricos de Acessos Banda Larga Fixa**

---
>
**Dev**: Gabriel Prata
>
**Data de criação**:    01/04/2024
>
**Última modificação**: 06/04/2024
>
---

#**<font color=#85d338 size="6"> 1. Import libraries**
"""

# Importação de pacotes
import pandas as pd
import numpy as np
import missingno as ms # para tratamento de missings

#bibliotecas para visualização de dados
import seaborn as sns
import plotly.express as px
import matplotlib.pyplot as plt

# Configuração para não exibir os warnings
import warnings
warnings.filterwarnings("ignore")

"""#**<font color=#85d338 size="6"> 2. Carga dos dados**

As informações de acessos de **Banda Larga Fixa**, estão no sítio de dados abertos do governo federal, no link abaixo:
>
https://dados.gov.br/dados/conjuntos-dados/acessos---banda-larga-fixa
>
Será baixado um arquivo ZIP com todos os anos disponíveis.
>
Para esse projeto, selecionamos os seguintes arquivos de **2023**, para tratar:
>
Acessos_Banda_Larga_Fixa_2023.zip
>
Acessos_Banda_Larga_Fixa_2023_Colunas.zip



---

###**<font color=#85d338> 2.1 Arquivo Acessos_Banda_Larga_Fixa_2023.zip**

Esse arquivo contém as informações detalhadas em tuplas.
"""

#Arquivo detalhado com os meses em linhas #executado em 34s
acesso_bl_2023 = pd.read_csv('Acessos_Banda_Larga_Fixa_2023.zip', compression='zip', sep=';', decimal=',')

acesso_bl_2023.info()

acesso_bl_2023.head()

"""###**<font color=#85d338> 2.2 Arquivo Acessos_Banda_Larga_Fixa_2023_Colunas.zip**

Arquivo agrupando o histórico de acessos em colunas.
"""

#Arquivo agrupando com os meses em colunas #executado em 4s
acesso_bl_2023_colunas = pd.read_csv('Acessos_Banda_Larga_Fixa_2023_Colunas.zip', compression='zip', sep=';', decimal=',')

acesso_bl_2023_colunas.info()

acesso_bl_2023_colunas.head()

"""---

#**<font color=#85d338 size="6"> 3. Análise de Dados Inicial**

###**<font color=#85d338> 3.1. Estatísticas Descritivas**

Compreende a organização, o resumo e, descrever os dados, que podem ser expressos em tabelas e gráficos.
>
Veremos a seguir alguns comandos para exibir algumas estatísticas descritivas.
>
---
"""

#	Quantidade de atributos e instâncias (linhas/colunas)
acesso_bl_2023.shape

acesso_bl_2023_colunas.shape

# verificando os tipos de dados de cada coluna do dataframe
acesso_bl_2023.dtypes

acesso_bl_2023_colunas.dtypes

# Mostra diversas informações do Dataframe em um único comando, e exibir o uso de memória
acesso_bl_2023.info(memory_usage="deep")

acesso_bl_2023_colunas.info(memory_usage="deep")

"""A função info() da biblioteca pandas, nos fornece um resumo do dataframe, sendo muito útil para ter uma visão geral do conjunto de dados.
>
Usando o parâmetro memory_usage = “deep”, saberemos exatamente quanto de memória o dataframe está utilizando.
>
Sendo assim, depois dos processos de transformações de dados saberemos se tivemos algum ganho de memoria no dataframe.
>
Inicialmente o dataframe detalhado está ocupando 5.2 Gigas de espaço.
>
O dataframe agrupado por coluna está ocupando 700 Mb de espaço.
"""

# Quantidade de valores únicos
acesso_bl_2023.nunique()

acesso_bl_2023_colunas.nunique()

# Quantidade de NaN/Missing/Nulls no dataframe
acesso_bl_2023.isnull().sum()

"""Nesse DF 3 atributos, apresentam registros nulos, que deverão ser tratados na etapa de pre-processamento de dados."""

# Quantidade de NaN/Missing/Nulls no dataframe
acesso_bl_2023_colunas.isnull().sum()

"""#**<font color=#85d338> 4. Pré-Processamento de dados**

Após coletar e analisar os dados na etapa anterior, agora é o momento
de limpar, transformar e apresentar melhor os dados.
>
Assim poderemos obter, na próxima etapa, os melhores resultados possíveis nos algoritmos de
Machine Learning, ou simplesmente apresentar dados mais confiáveis para os clientes em soluções de
business intelligence.


---

###**<font color=#85d338> 4.1. Limpeza**

####**<font color=#85d338> 4.1.1 Nomenclatura**

Nessa etpa iremos alterar o nome dos atributos
>
Retirando o "espaços" entre os nomes, os acentos e os caractéres especiais
"""

#Renomeando as colunas
acesso_bl_2023.rename(columns={ 'Ano': 'ano',
                                'Mês': 'mes',
                                'Grupo Econômico': 'grupo_economico',
                                'Empresa': 'empresa',
                                'Porte da Prestadora': 'porte_prestadora',
                                'Município': 'municipio',
                                'Código IBGE Município': 'codigo_ibge',
                                'Faixa de Velocidade': 'faixa_velocidade',
                                'Meio de Acesso': 'meio_acesso',
                                'Tipo de Pessoa': 'tipo_pessoa',
                                'Tipo de Produto': 'tipo_produto'
                              },
                      inplace=True)

#Renomeando as colunas
acesso_bl_2023_colunas.rename(columns={ 'Ano': 'ano',
                                'Mês': 'mes',
                                'Grupo Econômico': 'grupo_economico',
                                'Empresa': 'empresa',
                                'Porte da Prestadora': 'porte_prestadora',
                                'Município': 'municipio',
                                'Código IBGE Município': 'codigo_ibge',
                                'Faixa de Velocidade': 'faixa_velocidade',
                                'Meio de Acesso': 'meio_acesso',
                                'Tipo de Pessoa': 'tipo_pessoa',
                                'Tipo de Produto': 'tipo_produto'
                              },
                      inplace=True)

"""####**<font color=#85d338> 4.1.2 Redundâncias**

Vamos eliminar as colunas que não iremos utilizar em nossas analises.
>
A ideia é ter um dataframe mais leve, e com pouco espaço em disco.
"""

acesso_bl_2023.drop(['CNPJ',
                     'municipio',
                     'codigo_ibge',
                     'faixa_velocidade',
                     'Velocidade',
                     'Tecnologia',
                     'tipo_produto'
                     ], axis=1, inplace= True)

acesso_bl_2023_colunas.drop(['CNPJ',
                     'municipio',
                     'codigo_ibge',
                     'faixa_velocidade',
                     'Velocidade',
                     'Tecnologia',
                     'tipo_produto'
                     ], axis=1, inplace= True)

"""####**<font color=#85d338> 4.1.3 Tratamento de Missings**

O arquivo agrupado em colunas foi o que mais apresentou campos nulos(missings/NaN).
>
Iremos tratar todas as colunas.
"""

ms.matrix(acesso_bl_2023_colunas)

#Verificando o percentual de registros nulos
(acesso_bl_2023_colunas.isnull().sum()/acesso_bl_2023_colunas.shape[0]*100).round(2)

acesso_bl_2023_colunas['2023-01'].fillna(0, inplace=True)
acesso_bl_2023_colunas['2023-02'].fillna(0, inplace=True)
acesso_bl_2023_colunas['2023-03'].fillna(0, inplace=True)
acesso_bl_2023_colunas['2023-04'].fillna(0, inplace=True)
acesso_bl_2023_colunas['2023-05'].fillna(0, inplace=True)
acesso_bl_2023_colunas['2023-06'].fillna(0, inplace=True)
acesso_bl_2023_colunas['2023-07'].fillna(0, inplace=True)
acesso_bl_2023_colunas['2023-08'].fillna(0, inplace=True)
acesso_bl_2023_colunas['2023-09'].fillna(0, inplace=True)
acesso_bl_2023_colunas['2023-10'].fillna(0, inplace=True)
acesso_bl_2023_colunas['2023-11'].fillna(0, inplace=True)
acesso_bl_2023_colunas['2023-12'].fillna(0, inplace=True)

acesso_bl_2023_colunas.isnull().sum()

"""####**<font color=#85d338> 4.1.4 Outros**

Para reduzir mais o tamanho do DataFrame, vou substituir, no atributo: Tipo_pessoa
>
Os caracteres de Pessoa Juridica para PJ, e
>
Pessoa física para PF
"""

acesso_bl_2023.tipo_pessoa.value_counts(normalize=True)

acesso_bl_2023.tipo_pessoa =  acesso_bl_2023.tipo_pessoa.str.replace('Pessoa Jurídica','PJ')
acesso_bl_2023.tipo_pessoa =  acesso_bl_2023.tipo_pessoa.str.replace('Pessoa Física','PF')

"""---

###**<font color=#85d338> 4.2 Redução da dimensionalidade**

Os datasets podem ter muitas características, e muitos algoritmos de Machine Learning funcionam melhor se a dimensionalidade for menor.

####**<font color=#85d338> 4.2.1 Agregação**

Também pode ser considerada uma técnica de redução de dimensionalidade, pois reduz o número de colunas e linhas do dataset.
>
O nosso dataset, é aberto por Municipio, e nesse momento não iremos analisar nessa granularidade.
>
Vamos criar um dataset agregado com a visão por UF, agrupandos os atributos que não se repetem.
>
Assim, será possivel fazer analises mais rápidas, e ter um dataset menor para usar no Github e Streamlit.
"""

bl_fixa_2023 = acesso_bl_2023.groupby(["ano",
                                              "mes",
                                              "grupo_economico",
                                              "empresa",
                                              "porte_prestadora",
                                              "UF",
                                              "meio_acesso",
                                              "tipo_pessoa"])['Acessos'].sum().reset_index()

bl_fixa_2023.head()

"""O arquivo em colunas está aberto com a mesma granularidade do detalhado.
>
Vamos usar a mesma agregação.
"""

bl_fixa_2023_colunas = acesso_bl_2023_colunas.groupby(["grupo_economico",
                                                        "empresa",
                                                        "porte_prestadora",
                                                        "UF",
                                                        "meio_acesso",
                                                        "tipo_pessoa"]).sum(['2023-01','2023-02','2023-03','2023-04','2023-05','2023-06','2023-07','2023-08','2023-09','2023-10','2023-11','2023-12']).reset_index()

"""###**<font color=#85d338> 4.3 Exportar**

Nessa etapa, iremos exportar o arquivo para poder utiliza-lo no GitHub e no Streamlit.
"""

#Verificando o tamanho
bl_fixa_2023.info()

bl_fixa_2023.to_csv("banda_larga_fixa_2023.csv", encoding = 'utf-8')

"""**Arquivo CSV gerado com 22,9 MB**"""

bl_fixa_2023_colunas.info()

bl_fixa_2023_colunas.to_csv("banda_larga_fixa_2023_colunas.csv", encoding = 'utf-8')

"""**Arquivo CSV gerado com 4,5 MB**"""